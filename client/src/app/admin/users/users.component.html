<section class="users-container">
  <h1 class="title">{{ translation.translate('admin.users.title') }}</h1>
  <p class="subtitle">{{ translation.translate('admin.users.subtitle') }}</p>

  @if (error()) {
    <div class="error-message">
      {{ error() }}
    </div>
  }

  @if (isLoading()) {
    <div class="loading">{{ translation.translate('shared.loading') }}</div>
  } @else {
    <div class="users-table">
      @if (users().length > 0) {
        <table>
          <thead>
            <tr>
              <th>{{ translation.translate('admin.users.table.username') }}</th>
              <th>{{ translation.translate('admin.users.table.email') }}</th>
              <th>
                {{ translation.translate('admin.users.modal.firstName') }}
              </th>
              <th>{{ translation.translate('admin.users.modal.lastName') }}</th>
              <th>{{ translation.translate('admin.users.table.role') }}</th>
              <th>{{ translation.translate('admin.users.table.actions') }}</th>
            </tr>
          </thead>
          <tbody>
            @for (user of users(); track user.username) {
              <tr>
                <td>{{ user.username }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.firstName }}</td>
                <td>{{ user.lastName }}</td>
                <td>
                  <span class="role-badge" [class]="'role-' + user.role">{{
                    user.role
                  }}</span>
                </td>
                <td>
                  <button
                    class="btn btn-edit"
                    (click)="openEditModal(user)"
                    [disabled]="isSaving()"
                  >
                    {{ translation.translate('admin.users.buttons.edit') }}
                  </button>
                  <button
                    class="btn btn-delete"
                    (click)="deleteUser(user.username)"
                    [disabled]="isSaving() || isLastAdmin(user)"
                    [title]="
                      isLastAdmin(user)
                        ? translation.translate(
                            'admin.users.messages.lastAdminDeleteProtection'
                          )
                        : translation.translate('admin.users.buttons.delete')
                    "
                  >
                    {{ translation.translate('admin.users.buttons.delete') }}
                  </button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      } @else {
        <p class="no-users">
          {{ translation.translate('admin.users.noUsers') }}
        </p>
      }
    </div>
  }
</section>

@if (selectedUserForEdit()) {
  <app-edit-user-modal
    [user]="selectedUserForEdit()"
    [adminCount]="adminCount()"
    (closeModal)="closeEditModal()"
    (saveUser)="saveEditedUser($event)"
  ></app-edit-user-modal>
}
