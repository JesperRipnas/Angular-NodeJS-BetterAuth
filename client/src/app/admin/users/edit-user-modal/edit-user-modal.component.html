<div
  class="modal-overlay"
  (click)="onClose()"
  (keyup.escape)="onClose()"
  role="presentation"
>
  <div
    class="modal-content"
    (click)="$event.stopPropagation()"
    (keyup.escape)="$event.stopPropagation()"
    role="dialog"
  >
    <div class="modal-header">
      <h2>{{ translation.translate('admin.users.modal.editTitle') }}</h2>
      <button class="close-btn" (click)="onClose()" aria-label="Close modal">
        ×
      </button>
    </div>

    @if (formData() && user()) {
      <form class="modal-form">
        <div class="form-group">
          <label for="username">{{
            translation.translate('admin.users.table.username')
          }}</label>
          <div class="input-with-icon">
            <input
              type="text"
              id="username"
              [value]="formData()?.username ?? ''"
              (input)="onUsernameInput($any($event.target).value)"
            />
            @if (usernameStatus() !== 'idle') {
              <span
                class="status-icon"
                [class.is-valid]="usernameStatus() === 'valid'"
                [class.is-invalid]="usernameStatus() === 'invalid'"
                [attr.title]="
                  usernameStatus() === 'invalid'
                    ? translation.translate(
                        'admin.users.messages.usernameInvalidHint'
                      )
                    : null
                "
                aria-hidden="true"
              >
                {{ usernameStatus() === 'valid' ? '✓' : '✕' }}
              </span>
            }
          </div>
        </div>

        <div class="form-group">
          <label for="firstName">{{
            translation.translate('admin.users.modal.firstName')
          }}</label>
          <div class="input-with-icon">
            <input
              type="text"
              id="firstName"
              [value]="formData()?.firstName ?? ''"
              (input)="onFirstNameInput($any($event.target).value)"
            />
            @if (firstNameStatus() !== 'idle') {
              <span
                class="status-icon"
                [class.is-valid]="firstNameStatus() === 'valid'"
                [class.is-invalid]="firstNameStatus() === 'invalid'"
                [attr.title]="
                  firstNameStatus() === 'invalid'
                    ? translation.translate(
                        'admin.users.messages.firstnameInvalidHint'
                      )
                    : null
                "
                aria-hidden="true"
              >
                {{ firstNameStatus() === 'valid' ? '✓' : '✕' }}
              </span>
            }
          </div>
        </div>

        <div class="form-group">
          <label for="lastName">{{
            translation.translate('admin.users.modal.lastName')
          }}</label>
          <div class="input-with-icon">
            <input
              type="text"
              id="lastName"
              [value]="formData()?.lastName ?? ''"
              (input)="onLastNameInput($any($event.target).value)"
            />
            @if (lastNameStatus() !== 'idle') {
              <span
                class="status-icon"
                [class.is-valid]="lastNameStatus() === 'valid'"
                [class.is-invalid]="lastNameStatus() === 'invalid'"
                [attr.title]="
                  lastNameStatus() === 'invalid'
                    ? translation.translate(
                        'admin.users.messages.lastnameInvalidHint'
                      )
                    : null
                "
                aria-hidden="true"
              >
                {{ lastNameStatus() === 'valid' ? '✓' : '✕' }}
              </span>
            }
          </div>
        </div>

        <div class="form-group">
          <label for="email">{{
            translation.translate('admin.users.table.email')
          }}</label>
          <div class="input-with-icon">
            <input
              type="email"
              id="email"
              [value]="formData()?.email ?? ''"
              (input)="onEmailInput($any($event.target).value)"
            />
            @if (emailStatus() !== 'idle') {
              <span
                class="status-icon"
                [class.is-valid]="emailStatus() === 'valid'"
                [class.is-invalid]="emailStatus() === 'invalid'"
                [attr.title]="
                  emailStatus() === 'invalid'
                    ? translation.translate(
                        'admin.users.messages.emailInvalidHint'
                      )
                    : null
                "
                aria-hidden="true"
              >
                {{ emailStatus() === 'valid' ? '✓' : '✕' }}
              </span>
            }
          </div>
        </div>

        <div class="form-group">
          <label for="birthDate">{{
            translation.translate('admin.users.modal.birthDate')
          }}</label>
          <input
            type="date"
            id="birthDate"
            [value]="formData()?.birthDate ?? ''"
            (change)="updateField('birthDate', $any($event.target).value)"
          />
        </div>

        <div class="form-group">
          <label for="role">{{
            translation.translate('admin.users.table.role')
          }}</label>
          <select
            id="role"
            [value]="formData()?.role ?? ''"
            [disabled]="isLastAdmin()"
            [title]="
              isLastAdmin()
                ? translation.translate('admin.users.modal.lastAdminWarning')
                : ''
            "
            (change)="onRoleChange($any($event.target).value)"
          >
            <option value="user">
              {{ translation.translate('admin.users.roles.user') }}
            </option>
            <option value="admin">
              {{ translation.translate('admin.users.roles.admin') }}
            </option>
            <option value="seller">
              {{ translation.translate('admin.users.roles.seller') }}
            </option>
          </select>
          @if (isLastAdmin()) {
            <p class="text-yellow-600 text-sm mt-1">
              {{ translation.translate('admin.users.modal.lastAdminWarning') }}
            </p>
          }
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-cancel" (click)="onClose()">
            {{ translation.translate('admin.users.buttons.cancel') }}
          </button>
          <button
            type="button"
            class="btn btn-save"
            (click)="onSave()"
            [disabled]="!isModalValid()"
          >
            {{ translation.translate('admin.users.buttons.save') }}
          </button>
        </div>
      </form>
    }
  </div>
</div>
